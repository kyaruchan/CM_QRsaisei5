<!doctype html>
<html lang="ja">
<head>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="theme-color" content="#0b0f14">
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>コマーシャる音楽プレイヤー</title>
  <meta name="theme-color" content="#0b0f14" />
  <style>
    :root{
      --bg:#0b0f14; --fg:#e6edf3; --muted:#a9b1ba; --card:#111823; --border:#263041;
      --acc1:#3b82f6; --acc2:#22c55e; --radius:16px; --gap:12px; --tap:52px; --maxw:640px;
      --shadow:0 6px 18px rgba(0,0,0,.25);
    }
    html{font-size:17px} @media (min-width:480px){html{font-size:18px}}
    *{box-sizing:border-box}
    body{margin:0;color:var(--fg);background:var(--bg);
         -webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;
         font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,
         "Hiragino Sans","Noto Sans JP",Arial,sans-serif;}
    .wrap{margin:0 auto;max-width:var(--maxw);
          padding:calc(env(safe-area-inset-top) + 14px) 16px
                  calc(env(safe-area-inset-bottom) + 18px);}
    h1{font-size:1.25rem;margin:0 0 6px;letter-spacing:.02em}
    .note{margin:0;color:var(--muted);font-size:.95rem}
    .bar{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,var(--bg),rgba(11,15,20,.75));
         padding:12px 0 14px;margin:10px 0 8px;backdrop-filter:saturate(1.2) blur(6px)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
          box-shadow:var(--shadow);padding:10px}
    audio{width:100%;height:40px}
    .grid{display:grid;grid-template-columns:1fr;gap:var(--gap);margin-top:14px}
    @media (min-width:560px){.grid{grid-template-columns:1fr 1fr}}
    .btn{display:flex;align-items:center;justify-content:space-between;gap:10px;min-height:var(--tap);
         padding:12px 14px;width:100%;border-radius:var(--radius);border:1px solid var(--border);
         background:linear-gradient(180deg,#0f1622,#0c121b);color:var(--fg);font-size:1.02rem;
         letter-spacing:.01em;cursor:pointer;transition:transform .04s ease,border-color .18s ease,box-shadow .18s ease}
    .btn:hover{border-color:var(--acc1);box-shadow:0 0 0 3px rgba(59,130,246,.15) inset}
    .btn:active{transform:translateY(1px) scale(.99)}
    .btn .meta{color:var(--muted);font-size:.95rem}
    .btn.active{border-color:var(--acc2);box-shadow:0 0 0 3px rgba(34,197,94,.18) inset}
    details{margin-top:18px} summary{cursor:pointer}
    footer{margin-top:26px;color:var(--muted);font-size:.9rem}
    @media (prefers-reduced-motion: reduce){.btn,.btn:hover,.btn:active{transition:none}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>コマーシャる音楽プレイヤー</h1>
      <p class="note">ボタンで曲頭にジャンプ。PCは <b>1〜5</b> キーでもOK。</p>
    </header>

    <section class="bar">
      <div class="card">
        <audio id="player" controls preload="auto" playsinline></audio>
      </div>
    </section>

    <section id="chapters" class="grid" aria-label="チャプター一覧"></section>

    <details>
      <summary>ディープリンク</summary>
      <ul>
        <li><code>?t=30</code> … 30秒から開始</li>
        <li><code>#A</code> … ラベル一致の章から開始</li>
      </ul>
    </details>

    <footer><small>© audio chapter player</small></footer>
  </div>

  <script>
    /* ===== 設定（ここだけ編集） ===== */
    const AUDIO_SRC = "QR_5.mp3"; // 同じフォルダに置く
    const CHAPTERS = [
      { label:"A", start:0.3   },
      { label:"B", start:21.4  },
      { label:"C", start:40  },
      { label:"D", start:59.3  },
      { label:"E", start:80.2 },
    ];

    /* ===== ロジック ===== */
    const $audio = document.getElementById("player");
    const $list  = document.getElementById("chapters");
    $audio.src = AUDIO_SRC;

    function playSafe(){ $audio.play().catch(()=>{}); } // iOS初回タップ必要時は無視

    function formatTime(sec){
      const s = Math.floor(sec % 60).toString().padStart(2,"0");
      const m = Math.floor(sec / 60);
      return `${m}:${s}`;
    }

    function render(){
      $list.innerHTML = "";
      CHAPTERS.forEach((ch, i) => {
        const btn = document.createElement("button");
        btn.className = "btn"; btn.type = "button";
        btn.setAttribute("aria-label", `${ch.label}（${formatTime(ch.start)}〜）を再生`);
        btn.innerHTML = `<span>${i+1}. ${ch.label}</span><span class="meta">${formatTime(ch.start)}</span>`;
        btn.addEventListener("click", () => jump(ch.start));
        $list.appendChild(btn);
      });
    }

    function seekWhenReady(target){
      const go = () => { $audio.currentTime = target; playSafe(); };
      ($audio.readyState >= 1) ? go()
        : $audio.addEventListener("loadedmetadata", function on(){ $audio.removeEventListener("loadedmetadata", on); go(); });
    }

    function jump(sec){
      const t = Math.max(0, Number(sec) || 0);
      seekWhenReady(t);
    }

    // ディープリンク：?t=秒 / #ラベル
    function qs(name){ const p = new URLSearchParams(location.search); return p.get(name); }
    function hashLabel(){ return decodeURIComponent(location.hash.replace(/^#/,"")).trim() || null; }
    function handleDeepLink(){
      const t = qs("t"); if (t){ jump(parseFloat(t)); return; }
      const label = hashLabel();
      if (label){ const f = CHAPTERS.find(c => c.label === label); if (f) jump(f.start); }
    }

    // 現在章のハイライト
    function loopHighlight(){
      const t = $audio.currentTime;
      let idx = -1;
      for (let i=0;i<CHAPTERS.length;i++){
        const s = CHAPTERS[i].start;
        const n = (i<CHAPTERS.length-1) ? CHAPTERS[i+1].start : Infinity;
        if (t >= s && t < n){ idx = i; break; }
      }
      [...$list.children].forEach((el,i)=> el.classList.toggle("active", i===idx));
      requestAnimationFrame(loopHighlight);
    }

    // 数字キー 1〜9 でジャンプ
    addEventListener("keydown", (e)=>{
      if (["INPUT","TEXTAREA"].includes(e.target?.tagName)) return;
      const n = parseInt(e.key,10);
      if (!isNaN(n) && n>=1 && n<=9 && CHAPTERS[n-1]) jump(CHAPTERS[n-1].start);
    });

    render();
    handleDeepLink();
    requestAnimationFrame(loopHighlight);

    if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./service-worker.js")
      .catch(console.error);
  });
}
  </script>
</body>
</html>


